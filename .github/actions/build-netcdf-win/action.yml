name: Build NetCDF (Windows)
description: Build NetCDF on Windows
runs:
  using: "composite"
  steps:

    - name: Convert line endings
      shell: cmd
      run: |
        unix2dos -n "%GITHUB_WORKSPACE%\modflow6\.github\common\compile_netcdf.sh" "%TEMP%\compile_netcdf.sh"

    - name: Get date
      id: get-date
      shell: bash
      run: echo "date=$(/bin/date -u "+%Y%m%d")" >> "$GITHUB_OUTPUT"

    - name: Setup oneAPI
      uses: ./modflow6/.github/actions/setup-par-oneapi

    - name: Setup 7-zip
      uses: milliewalky/setup-7-zip@v1

    - name: Download NetCDF-C
      shell: bash
      run: |
        mkdir netcdf
        cd netcdf
        curl https://downloads.unidata.ucar.edu/netcdf-c/4.9.2/netCDF4.9.2-NC4-64.exe -O -J
        7z x netCDF4.9.2-NC4-64.exe -aou
        ls netCDF4.9.2-NC4-64

    - name: Download NetCDF-Fortran
      shell: bash
      run: |
        cd netcdf
        mkdir netcdf-fortran-4.6.1_build
        cd netcdf-fortran-4.6.1_build
        curl https://downloads.unidata.ucar.edu/netcdf-fortran/4.6.1/netcdf-fortran-4.6.1.zip -O -J
        unzip netcdf-fortran-4.6.1.zip
        ls netcdf-fortran-4.6.1
        mkdir build

    - name: Build NetCDF
      shell: cmd
      run: |
        "%ONEAPI_ROOT%\setvars.bat" intel64 vs2022 && "C:\tools\cygwin\bin\bash.exe" --login --norc -eo pipefail -o igncr "%TEMP%\compile_netcdf.sh"

#    - name: Setup PETSC environment
#      shell: cmd
#      run: |
#        set PETSC_DIR=%GITHUB_WORKSPACE%\petsc
#        set PETSC_ARCH=arch-mswin-c-opt
#        echo PETSC_DIR=%PETSC_DIR%>>%GITHUB_ENV%
#        echo PETSC_ARCH=%PETSC_ARCH%>>%GITHUB_ENV%
#        echo %PETSC_DIR%\%PETSC_ARCH%\lib>>%GITHUB_PATH%
